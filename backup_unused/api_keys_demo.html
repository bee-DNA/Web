<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Keys 配置示例</title>
    <!-- Mapbox GL JS -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.6.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.6.0/mapbox-gl.css' rel='stylesheet' />
    
    <!-- 引用 API Keys 配置 -->
    <script src="api_keys.js"></script>
</head>
<body>
    <div id="map" style="width: 100%; height: 400px;"></div>
    <div style="padding: 20px;">
        <h3>API Keys 配置示例</h3>
        <button onclick="testApiKeys()">測試 API Keys</button>
        <button onclick="testWeatherApi()">測試天氣 API</button>
        <div id="output" style="margin-top: 10px; padding: 10px; background: #f5f5f5;"></div>
    </div>

    <script>
        // 地圖會自動使用配置的 Mapbox Token
        const map = new mapboxgl.Map({
            container: 'map',
            style: API_CONFIG.MAPBOX.STYLES.light,
            center: [121.5654, 25.0330], // 台北
            zoom: 10
        });

        function testApiKeys() {
            const output = document.getElementById('output');
            const validation = validateApiKeys();
            
            output.innerHTML = `
                <h4>API Keys 驗證結果:</h4>
                <p>Mapbox: ${validation.mapbox ? '✅ 有效' : '❌ 無效'}</p>
                <p>OpenWeather: ${validation.openweather ? '✅ 有效' : '❌ 無效'}</p>
                <p>NOAA: ${validation.noaa ? '✅ 有效' : '❌ 無效'}</p>
                <hr>
                <p><strong>Mapbox Token:</strong> ${API_KEYS.MAPBOX_ACCESS_TOKEN.substring(0, 20)}...</p>
                <p><strong>OpenWeather Key:</strong> ${API_KEYS.OPENWEATHER_API_KEY.substring(0, 10)}...</p>
            `;
        }

        function testWeatherApi() {
            const output = document.getElementById('output');
            
            // 使用便捷函數取得 API URL
            const weatherUrl = getWeatherApiUrl('current', {
                lat: 25.0330,
                lon: 121.5654,
                units: 'metric',
                lang: 'zh_tw'
            });
            
            output.innerHTML = `
                <h4>天氣 API 測試:</h4>
                <p><strong>API URL:</strong></p>
                <code style="word-break: break-all;">${weatherUrl}</code>
                <p><strong>正在取得台北天氣資料...</strong></p>
            `;
            
            // 實際呼叫 API
            fetch(weatherUrl)
                .then(response => response.json())
                .then(data => {
                    output.innerHTML += `
                        <h4>台北目前天氣:</h4>
                        <p>溫度: ${data.main.temp}°C</p>
                        <p>天氣: ${data.weather[0].description}</p>
                        <p>濕度: ${data.main.humidity}%</p>
                        <p>風速: ${data.wind.speed} m/s</p>
                    `;
                })
                .catch(error => {
                    output.innerHTML += `<p style="color: red;">API 呼叫失敗: ${error.message}</p>`;
                });
        }

        // 地圖載入完成後的回調
        map.on('load', function() {
            console.log('✅ 地圖載入完成，使用 Mapbox Token:', API_KEYS.MAPBOX_ACCESS_TOKEN.substring(0, 20) + '...');
            
            // 添加台北市標記
            new mapboxgl.Marker()
                .setLngLat([121.5654, 25.0330])
                .setPopup(new mapboxgl.Popup().setHTML('<strong>台北市</strong><br>API 配置測試點'))
                .addTo(map);
        });
    </script>
</body>
</html>